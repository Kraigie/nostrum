<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.0">
    <meta name="project" content="Nostrum v0.11.0-dev">


    <title>Pluggable caching — Nostrum v0.11.0-dev</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-5C7EC29F.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-6VTPNSGQ.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Nostrum" />
        </a>

      <div>
        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectName" translate="no">
Nostrum
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.11.0-dev
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Nostrum</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Pluggable caching</h1>


      <a href="https://github.com/Kraigie/nostrum/blob/master/guides/advanced/pluggable_caching.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>

<p>The default ETS-based caches supplied by nostrum should work for most of your
needs, but all of the caches can be exchanged for your own implementations. For
this, implement the behaviours exported by the cache modules under
<code class="inline">Nostrum.Cache</code>.</p><section role="note" class="admonition info"><h3 id="exception" class="admonition-title info section-heading">
  <a href="#exception" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Exception</span>
</h3>
<p>The exception to the above is the <a href="Nostrum.Cache.MessageCache.html"><code class="inline">Nostrum.Cache.MessageCache</code></a>, which does not
include an ETS-based implementation, and defaults to a NoOp cache. This is
an intentional design decision because caching messages consumes a
lot more memory than other objects, and is often not needed by most users.</p></section><p>Use the <code class="inline">[:nostrum, :caches]</code> configuration for configuring which cache
implementation you want to use. This can only be set at dependency compilation
time. A common situation is that you don't want to cache presences in your bot,
most likely you don't care about user's status, so you can disable it altogether
by using the <code class="inline">NoOp</code> presence cache:</p><pre><code class="makeup elixir" translate="no"><span class="n">config</span><span class="w"> </span><span class="ss">:nostrum</span><span class="p">,</span><span class="w">
  </span><span class="ss">caches</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6790853132-1">%{</span><span class="w">
    </span><span class="ss">presences</span><span class="p">:</span><span class="w"> </span><span class="nc">Nostrum.Cache.PresenceCache.NoOp</span><span class="w">
  </span><span class="p" data-group-id="6790853132-1">}</span></code></pre><p>In addition to regular caches that associate Discord snowflakes with the proper
&quot;full&quot; object, nostrum also maintains junction table-like mappings that allow
you to find the matching object from one cache in another. One example for this
is <a href="Nostrum.Cache.ChannelGuildMapping.html"><code class="inline">Nostrum.Cache.ChannelGuildMapping</code></a>.</p><p>Nostrum also ships with Mnesia-based caches. <strong>These are only compiled in when
mnesia is available</strong>: they may not be available on Nerves or when Mnesia was
not installed with OTP.</p><h2 id="implementations" class="section-heading">
  <a href="#implementations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Implementations</span>
</h2>
<h3 id="ets-caching" class="section-heading">
  <a href="#ets-caching" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">ETS caching</span>
</h3>
<p>Caching based on <code class="inline">:ets</code> is used by default. No configuration is required. Fast,
light on memory, but does not support any form of distribution or secondary
indexing: queries such as fetching all guild members for a guild by its ID will
perform a full table scan. For smaller bots, this is perfectly acceptable.</p><h3 id="mnesia-caching" class="section-heading">
  <a href="#mnesia-caching" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Mnesia caching</span>
</h3>
<p>Mnesia-based caching is mainly suggested for larger bots that require
features such as cache distribution, fragmentation, secondary indexing and more.</p><p>The caches will attempt to create their tables automatically at startup:
therefore, Mnesia must be started ahead of nostrum. Caches expose a function
<code class="inline">table/0</code> that can be called to retrieve the table name used by the cache and
perform schema operations on it, such as adding replicas or fragmenting them.</p><!-- From 1.0, add the following: Any future schema migrations that nostrumneeds to perform will be automatically performed at cache startup. --><p>Access to Mnesia is presently done in <code class="inline">sync_transaction</code> mode for best
consistency. If needed, a compile-time configuration option for the cache to
switch this can be added.</p><p>Mnesia-based caching assumes the user is familar with usage and
maintenance of Mnesia: the <a href="https://www.erlang.org/doc/apps/mnesia/mnesia_chap1.html">Mnesia User's
Guide</a> is a good
starting point.</p><h3 id="noop-caching" class="section-heading">
  <a href="#noop-caching" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">NoOp caching</span>
</h3>
<p>The NoOp cache adapters are supplied for the case where you do not want to cache
specific data from Discord at all.</p><h2 id="cache-invalidation" class="section-heading">
  <a href="#cache-invalidation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Cache invalidation</span>
</h2>
<p>Nostrum does not invalidate most caches in any special way: it will maintain it in
response to gateway events (for instance by deleting a guild and its members
upon leaving it), but won't regularly prune caches or associate expiration times
with entries. For volatile (RAM-based) caches this is perfectly fine, however,
when implementing your own cache backend that persists to disk in some way, you
need to take care of this yourself.</p><p>The exception to this is the <a href="Nostrum.Cache.MessageCache.Mnesia.html"><code class="inline">Nostrum.Cache.MessageCache.Mnesia</code></a> module, which has a
default size limit of 10,000 and will automatically remove the 100 oldest
messages when this limit is reached as well as delete all cached messages for a
channel when the channel is deleted.</p><h2 id="cache-performance" class="section-heading">
  <a href="#cache-performance" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Cache performance</span>
</h2>
<p>nostrum strives to provide the most performant caches on the Discord bot caching
market. If you run into performance issues with caches that you feel are not
adequately documented as such, please feel free to open an issue.</p><p>Benchmarks for caches can be found in the <a href="https://github.com/Kraigie/nostrum/tree/master/benchmarks"><code class="inline">benchmarks/</code>
directory</a> of the
source code tree. If you want to get a feeling for how the caches perform or
implement optimizations, check them out.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="multi_node.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Multi-node
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="api-1.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
API Usage
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/nostrum/0.11.0-dev" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/nostrum/0.11.0-dev">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/nostrum/0.11.0-dev/show/guides/advanced/pluggable_caching.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Nostrum.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.0) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
