<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.2">
    <meta name="project" content="nostrum v0.11.0-dev">


    <title>Nostrum.Shard.Session â€” nostrum v0.11.0-dev</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-A1587C9C.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-6XHBGSGW.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="nostrum" />
        </a>

      <div>
        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectName" translate="no">
nostrum
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.11.0-dev
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of nostrum</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Nostrum.Shard.Session</span> 
      <small class="app-vsn" translate="no">(nostrum v0.11.0-dev)</small>

    </h1>

      <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Manages a single shard's gateway connection.</p><h2 id="module-purpose" class="section-heading">
  <a href="#module-purpose" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Purpose</span>
</h2>
<p>Discord's gateway sends us events over websocket. The shard session state
machine concerns it self with parsing these events and dispatching them to
clients as appropriate.</p><section role="note" class="admonition info"><h3 id="module-internal-module" class="admonition-title info section-heading">
  <a href="#module-internal-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Internal module</span>
</h3>
<p>This module is intended for exclusive usage inside of nostrum, and is
documented for completeness and people curious to look behind the covers.</p></section><h2 id="module-inner-workings" class="section-heading">
  <a href="#module-inner-workings" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Inner workings</span>
</h2>
<p>The session is implemented via <code class="inline">:gen_statem</code> and can be in one of the
following states:</p><ul><li><p><code class="inline">disconnected</code>: when no connection is up at all. On initial connection of
the session (e.g. no <code class="inline">seq</code> field is available), this will block if we need to
wait a moment to respect the session startup concurrency limits. Afterwards,
it will transition to <code class="inline">connecting_http</code>.</p></li><li><p><code class="inline">connecting_http</code>: We are setting up a HTTP connection to the API. This
means that no connection was available previously at all, and we need to open
it from scratch. Used for gateway-initiated reconnect requests (&quot;Cloudflare
Websocket proxy restarting&quot;) and on <code class="inline">:gun_down</code> notifications for the
connection in connected state. Once <code class="inline">:gun</code> notifies us that the connection is
up, we transition to the <code class="inline">connecting_ws</code> state.</p></li><li><p><code class="inline">connecting_ws</code>: We are turning the HTTP connection into a WebSocket
connection. If this succeeds, we head into the <code class="inline">connected</code> state.</p></li><li><p><code class="inline">connected</code>: The WebSocket connection is up. This state actively deals with
new data from the gateway, and takes care of heartbeating. If Discord fails
to respond to our heartbeats, we close down the full connection and attempt
to re-establish and resume events.</p></li></ul>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#callback_mode/0" data-no-tooltip="" translate="no">callback_mode()</a>

      </div>

        <div class="summary-synopsis"><p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:callback_mode/0"><code class="inline">:gen_statem.callback_mode/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#child_spec/1" data-no-tooltip="" translate="no">child_spec(opts)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#connected/3" data-no-tooltip="" translate="no">connected(arg1, request, data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#connecting_http/3" data-no-tooltip="" translate="no">connecting_http(arg1, from, data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#connecting_ws/3" data-no-tooltip="" translate="no">connecting_ws(arg1, arg2, data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#disconnect/1" data-no-tooltip="" translate="no">disconnect(pid)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#disconnect/2" data-no-tooltip="" translate="no">disconnect(pid, timeout)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#disconnected/3" data-no-tooltip="" translate="no">disconnected(arg1, arg2, data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#format_status/1" data-no-tooltip="" translate="no">format_status(state)</a>

      </div>

        <div class="summary-synopsis"><p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:format_status/1"><code class="inline">:gen_statem.format_status/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_ws_state/1" data-no-tooltip="" translate="no">get_ws_state(pid)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#init/1" data-no-tooltip="" translate="no">init(opts)</a>

      </div>

        <div class="summary-synopsis"><p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:init/1"><code class="inline">:gen_statem.init/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#request_guild_members/3" data-no-tooltip="" translate="no">request_guild_members(pid, guild_id, limit \\ 0)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_link/2" data-no-tooltip="" translate="no">start_link(shard_opts, statem_opts)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_status/3" data-no-tooltip="" translate="no">update_status(pid, status, activity)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_voice_state/5" data-no-tooltip="" translate="no">update_voice_state(pid, guild_id, channel_id, self_mute, self_deaf)</a>

      </div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="callback_mode/0">

  <div class="detail-header">
    <a href="#callback_mode/0" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">callback_mode()</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L176" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:callback_mode/0"><code class="inline">:gen_statem.callback_mode/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="child_spec/1">

  <div class="detail-header">
    <a href="#child_spec/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">child_spec(opts)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L178" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="connected/3">

  <div class="detail-header">
    <a href="#connected/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">connected(arg1, request, data)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L319" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="connecting_http/3">

  <div class="detail-header">
    <a href="#connecting_http/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">connecting_http(arg1, from, data)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L219" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="connecting_ws/3">

  <div class="detail-header">
    <a href="#connecting_ws/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">connecting_ws(arg1, arg2, data)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L256" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="disconnect/1">

  <div class="detail-header">
    <a href="#disconnect/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">disconnect(pid)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L130" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="disconnect/2">

  <div class="detail-header">
    <a href="#disconnect/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">disconnect(pid, timeout)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L134" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="disconnected/3">

  <div class="detail-header">
    <a href="#disconnected/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">disconnected(arg1, arg2, data)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L191" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="format_status/1">

  <div class="detail-header">
    <a href="#format_status/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">format_status(state)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L489" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:format_status/1"><code class="inline">:gen_statem.format_status/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="get_ws_state/1">

  <div class="detail-header">
    <a href="#get_ws_state/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">get_ws_state(pid)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L138" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="init/1">

  <div class="detail-header">
    <a href="#init/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">init(opts)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L150" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Callback implementation for <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#c:init/1"><code class="inline">:gen_statem.init/1</code></a>.</p>
  </section>
</section>
<section class="detail" id="request_guild_members/3">

    <span id="request_guild_members/2"></span>

  <div class="detail-header">
    <a href="#request_guild_members/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">request_guild_members(pid, guild_id, limit \\ 0)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L125" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="start_link/2">

  <div class="detail-header">
    <a href="#start_link/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">start_link(shard_opts, statem_opts)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L143" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_status/3">

  <div class="detail-header">
    <a href="#update_status/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_status(pid, status, activity)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L96" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_voice_state/5">

  <div class="detail-header">
    <a href="#update_voice_state/5" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_voice_state(pid, guild_id, channel_id, self_mute, self_deaf)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/session.ex#L120" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/nostrum/0.11.0-dev" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/nostrum/0.11.0-dev">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="nostrum.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
