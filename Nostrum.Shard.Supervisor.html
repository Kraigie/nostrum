<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.2">
    <meta name="project" content="nostrum v0.11.0-dev">


    <title>Nostrum.Shard.Supervisor â€” nostrum v0.11.0-dev</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-0E677A87.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-6XHBGSGW.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="nostrum" />
        </a>

      <div>
        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectName" translate="no">
nostrum
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.11.0-dev
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of nostrum</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Nostrum.Shard.Supervisor</span> 
      <small class="app-vsn" translate="no">(nostrum v0.11.0-dev)</small>

    </h1>

      <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Supervises shard processes.</p><h2 id="module-purpose" class="section-heading">
  <a href="#module-purpose" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Purpose</span>
</h2>
<p>nostrum allows to start both an automatic shard count as well as manually
starting shards. This module supervises shards and provides <a href="#connect/4"><code class="inline">connect/4</code></a>,
<a href="#disconnect/3"><code class="inline">disconnect/3</code></a> and <a href="#reconnect/2"><code class="inline">reconnect/2</code></a> to facilitate both manual starting of shards
as well as migrating shards with resume information.</p><h2 id="module-implementation" class="section-heading">
  <a href="#module-implementation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Implementation</span>
</h2>
<p>As events are sent to the shard, the following happens:</p><ol><li><p>Shard looks to see what type of event it is, only dispatch events are sent
to the producer.</p></li><li><p>If the event is a <code class="inline">Dispatch</code>, the payload is converted to an atom-keyed map.
This is done because over ETF (which Nostrum uses), map keys are sometimes
binaries and sometimes strings, making it a real headache. Additionally,
with atom keys, we can use the <code class="inline">Map.key</code> notation. This is normally
considered unsafe but a debug messages will be emitted if a key is unsafely
converted to an atom. In this way we can ensure that our atom table is not
growing unbounded.</p></li><li><p>The payload is then written to the cache. To make sure we're not overrunning
the cache, especially at startup with <code class="inline">request_guild_members</code> or other heavy
payloads, this is done in the shard itself.</p></li><li><p>The cache updates itself from the new data. In some cases, such as update or
delete events, it may send out a second &quot;old&quot; object as well, that helps the
library user to determine what changed.</p></li><li><p>After writing to the cache, the shard <code class="inline">send</code>s out the event after going
through the cache to all subscribed processes. In general, the payload will
often match the payload described by the official Discord API documentation.</p></li><li><p>The shard instructs the websocket client that it's ready to read more data.
This prevents flooding the shard with messages that it may not be able to
handle yet, thus growing the message queue and the memory usage.</p></li></ol>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:resume_information/0" data-no-tooltip="" translate="no">resume_information()</a>

      </div>

        <div class="summary-synopsis"><p>Represents gateway resume information.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:shard_num/0" data-no-tooltip="" translate="no">shard_num()</a>

      </div>

        <div class="summary-synopsis"><p>Shard number(<code class="inline">shard_id</code>). Range is <code class="inline">0..total_shards-1</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:total_shards/0" data-no-tooltip="" translate="no">total_shards()</a>

      </div>

        <div class="summary-synopsis"><p>Total shard count(<code class="inline">num_shards</code>).</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#child_spec/1" data-no-tooltip="" translate="no">child_spec(init_arg)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a specification to start this module under a supervisor.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#connect/4" data-no-tooltip="" translate="no">connect(supervisor \\ fetch_shard_sup_pid(), shard_num, total_shards, bot_options)</a>

      </div>

        <div class="summary-synopsis"><p>Spawns a shard with the specified number and connects it to the discord gateway.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#disconnect/3" data-no-tooltip="" translate="no">disconnect(supervisor \\ fetch_shard_sup_pid(), shard_session \\ nil, shard_num)</a>

      </div>

        <div class="summary-synopsis"><p>Disconnects the shard with the given shard number from the Gateway.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reconnect/2" data-no-tooltip="" translate="no">reconnect(supervisor \\ fetch_shard_sup_pid(), opts)</a>

      </div>

        <div class="summary-synopsis"><p>Reconnect to the gateway using the provided <a href="#t:resume_information/0"><code class="inline">resume_information/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_link/1" data-no-tooltip="" translate="no">start_link(bot_options)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_status/2" data-no-tooltip="" translate="no">update_status(status, activity)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_voice_state/4" data-no-tooltip="" translate="no">update_voice_state(guild_id, channel_id, self_mute, self_deaf)</a>

      </div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:resume_information/0">

  <div class="detail-header">
    <a href="#t:resume_information/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">resume_information()</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L55" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> resume_information() :: %{
  shard_num: <a href="#t:shard_num/0">shard_num</a>(),
  total_shards: <a href="#t:total_shards/0">total_shards</a>(),
  gateway: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  bot_options: <a href="Nostrum.Bot.html#t:bot_options/0">Nostrum.Bot.bot_options</a>(),
  resume_gateway: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil,
  session: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(),
  seq: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pos_integer</a>()
}</pre>

      </div>

<p>Represents gateway resume information.</p>
  </section>
</section>
<section class="detail" id="t:shard_num/0">

  <div class="detail-header">
    <a href="#t:shard_num/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">shard_num()</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L47" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> shard_num() :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">non_neg_integer</a>()</pre>

      </div>

<p>Shard number(<code class="inline">shard_id</code>). Range is <code class="inline">0..total_shards-1</code>.</p>
  </section>
</section>
<section class="detail" id="t:total_shards/0">

  <div class="detail-header">
    <a href="#t:total_shards/0" class="detail-link" data-no-tooltip="" aria-label="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">total_shards()</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L51" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> total_shards() :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">pos_integer</a>()</pre>

      </div>

<p>Total shard count(<code class="inline">num_shards</code>).</p>
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="child_spec/1">

  <div class="detail-header">
    <a href="#child_spec/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">child_spec(init_arg)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L65" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

<p>Returns a specification to start this module under a supervisor.</p><p>See <a href="https://hexdocs.pm/elixir/Supervisor.html"><code class="inline">Supervisor</code></a>.</p>
  </section>
</section>
<section class="detail" id="connect/4">

    <span id="connect/3"></span>

  <div class="detail-header">
    <a href="#connect/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">connect(supervisor \\ fetch_shard_sup_pid(), shard_num, total_shards, bot_options)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L201" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> connect(
  <a href="https://hexdocs.pm/elixir/Supervisor.html#t:supervisor/0">Supervisor.supervisor</a>(),
  <a href="#t:shard_num/0">shard_num</a>(),
  <a href="#t:total_shards/0">total_shards</a>(),
  <a href="Nostrum.Bot.html#t:bot_options/0">Nostrum.Bot.bot_options</a>()
) ::
  <a href="https://hexdocs.pm/elixir/Supervisor.html#t:on_start_child/0">Supervisor.on_start_child</a>()</pre>

      </div>

<p>Spawns a shard with the specified number and connects it to the discord gateway.</p>
  </section>
</section>
<section class="detail" id="disconnect/3">

    <span id="disconnect/1"></span>

    <span id="disconnect/2"></span>

  <div class="detail-header">
    <a href="#disconnect/3" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">disconnect(supervisor \\ fetch_shard_sup_pid(), shard_session \\ nil, shard_num)</h1>

        <span class="note">(since 0.10.0)</span>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L189" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> disconnect(<a href="https://hexdocs.pm/elixir/Supervisor.html#t:supervisor/0">Supervisor.supervisor</a>(), <a href="https://www.erlang.org/doc/apps/stdlib/gen_statem.html#t:server_ref/0">:gen_statem.server_ref</a>() | nil, <a href="#t:shard_num/0">shard_num</a>()) ::
  <a href="#t:resume_information/0">resume_information</a>()</pre>

      </div>

<p>Disconnects the shard with the given shard number from the Gateway.</p><p>This function returns <a href="#t:resume_information/0"><code class="inline">resume_information/0</code></a> which can be provided
to <a href="#reconnect/1"><code class="inline">reconnect/1</code></a> to reconnect a shard to the gateway and (attempt) to
catch up on any missed events.</p><h3 id="disconnect/3-examples" class="section-heading">
  <a href="#disconnect/3-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">Nostrum.Shard.Supervisor</span><span class="o">.</span><span class="n">disconnect</span><span class="p" data-group-id="3170874215-1">(</span><span class="mi">4</span><span class="p" data-group-id="3170874215-1">)</span><span class="w">
</span><span class="p" data-group-id="3170874215-2">%{</span><span class="ss">shard_num</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="3170874215-2">}</span></code></pre>
  </section>
</section>
<section class="detail" id="reconnect/2">

    <span id="reconnect/1"></span>

  <div class="detail-header">
    <a href="#reconnect/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">reconnect(supervisor \\ fetch_shard_sup_pid(), opts)</h1>

        <span class="note">(since 0.10.0)</span>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L230" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> reconnect(<a href="https://hexdocs.pm/elixir/Supervisor.html#t:supervisor/0">Supervisor.supervisor</a>(), <a href="#t:resume_information/0">resume_information</a>()) ::
  <a href="https://hexdocs.pm/elixir/Supervisor.html#t:on_start_child/0">Supervisor.on_start_child</a>()</pre>

      </div>

<p>Reconnect to the gateway using the provided <a href="#t:resume_information/0"><code class="inline">resume_information/0</code></a>.</p><p>Resuming is performed by the gateway on a best effort basis, it is not
guaranteed that a resume will work (though Nostrum will handle failed attempts
at a resumption). If a reconnect is successful, any events received during the
reconnection period should be received. If the reconnect fails, events
received between the disconnect and re-authentication may be lost.</p><p>For more information about resuming sessions, visit
<a href="https://discord.com/developers/docs/topics/gateway#resuming">the Discord Developer Portal</a>.</p><h3 id="reconnect/2-examples" class="section-heading">
  <a href="#reconnect/2-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">resume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nostrum.Shard.Supervisor</span><span class="o">.</span><span class="n">disconnect</span><span class="p" data-group-id="6788845138-1">(</span><span class="mi">4</span><span class="p" data-group-id="6788845138-1">)</span><span class="w">
</span><span class="p" data-group-id="6788845138-2">%{</span><span class="ss">shard_num</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6788845138-2">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Nostrum.Shard.Supervisor</span><span class="o">.</span><span class="n">reconnect</span><span class="p" data-group-id="6788845138-3">(</span><span class="n">resume</span><span class="p" data-group-id="6788845138-3">)</span></code></pre>
  </section>
</section>
<section class="detail" id="start_link/1">

  <div class="detail-header">
    <a href="#start_link/1" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">start_link(bot_options)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L96" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_status/2">

  <div class="detail-header">
    <a href="#update_status/2" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_status(status, activity)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L115" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="update_voice_state/4">

  <div class="detail-header">
    <a href="#update_voice_state/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">update_voice_state(guild_id, channel_id, self_mute, self_deaf)</h1>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/shard/supervisor.ex#L122" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">


  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/nostrum/0.11.0-dev" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/nostrum/0.11.0-dev">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="nostrum.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
