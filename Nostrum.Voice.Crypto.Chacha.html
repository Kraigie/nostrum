<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.37.2">
    <meta name="project" content="nostrum v0.11.0-dev">


    <title>Nostrum.Voice.Crypto.Chacha â€” nostrum v0.11.0-dev</title>

    <link rel="stylesheet" href="dist/html-elixir-6X3L5KMG.css" />

    <script defer src="dist/sidebar_items-35D5AD02.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-6XHBGSGW.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="nostrum" />
        </a>

      <div>
        <a href="https://github.com/Kraigie/nostrum" class="sidebar-projectName" translate="no">
nostrum
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.11.0-dev
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-module" id="main" data-type="modules">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of nostrum</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>
      <span translate="no">Nostrum.Voice.Crypto.Chacha</span> 
      <small class="app-vsn" translate="no">(nostrum v0.11.0-dev)</small>

    </h1>

      <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/voice/crypto/chacha.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


    <section id="moduledoc">
<p>Handles encryption and decryption of outgoing and incoming voice data when a ChaCha encryption mode is selected</p><section role="note" class="admonition info"><h3 id="module-internal-module" class="admonition-title info section-heading">
  <a href="#module-internal-module" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Internal module</span>
</h3>
<p>This module is intended for exclusive usage inside of nostrum, and is
documented for completeness and curious cryptographic cats.</p></section><h3 id="module-purpose" class="section-heading">
  <a href="#module-purpose" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Purpose</span>
</h3>
<p>Erlang's <code class="inline">:crypto</code> module supports the chacha20_poly1305 AEAD stream cipher.
Analogously to Salsa20 and XSalsa20, XChaCha20 is a way to use 192-bit nonces
with ChaCha20 by hashing the key and part of the extended nonce to generate a
sub-key, which is used as the input key for ChaCha20.</p><p>To leverage the crypto module, we had to implement the HChaCha20 hash function
in elixir to then pass the resulting sub-key to the <code class="inline">crypto_one_time_aead</code>.</p><h3 id="module-implementation" class="section-heading">
  <a href="#module-implementation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Implementation</span>
</h3>
<p>The HChaCha20 function takes the first 16-bytes of the extended 24-byte XChaCha20 nonce,
expands the key and the 16-byte nonce slice into a block in place of the block count and
usual smaller nonce. That block has 20 rounds of mutation, and instead of summing the block
with its starting state as is done with keystream generation, 8 of the 16 bytes are taken
and used as the sub-key, which is the input key for the standard chacha20 cipher.</p><p>Even though we've implemented the bulk of what's needed to generate chacha20 key streams
for encryption and decryption, we're only using this module to generate the inputs to
use the :crypto module's chacha20_poly1305 functionality in the capacity of xchacha20
as is required by Discord with that encryption mode selected.</p><p>This is all in service of leveraging the performance benefits of the the NIF crypto
functions, which are necessarily going to be more performant than anything implemented
in pure elixir/erlang like the <code class="inline">:kcl</code> package.</p><p><em>ChaCha20 is a variant of the Salsa20 cipher. I will discuss in greater detail the implementation
in the <a href="Nostrum.Voice.Crypto.Salsa.html"><code class="inline">Nostrum.Voice.Crypto.Salsa</code></a> module, where much is applicable here.</em></p><p>References for Salsa family of ciphers</p><ul><li><a href="https://cr.yp.to/snuffle/spec.pdf">https://cr.yp.to/snuffle/spec.pdf</a></li><li><a href="https://cr.yp.to/chacha/chacha-20080128.pdf">https://cr.yp.to/chacha/chacha-20080128.pdf</a></li><li><a href="https://cr.yp.to/snuffle/xsalsa-20110204.pdf">https://cr.yp.to/snuffle/xsalsa-20110204.pdf</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7539">https://datatracker.ietf.org/doc/html/rfc7539</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-xchacha">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-xchacha</a></li></ul><h3 id="module-performance-considerations" class="section-heading">
  <a href="#module-performance-considerations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Performance considerations</span>
</h3>
<p>After the XChaCha20 sub-key is generated in elixir, the crypto NIF function performs the
heavy lifting. If your bot is running on a machine without AES hardware acceleration, you
may find that using the chacha encryption mode yields better performance.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#decrypt/5" data-no-tooltip="" translate="no">decrypt(cipher_text, key, nonce, aad, tag)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#encrypt/4" data-no-tooltip="" translate="no">encrypt(plain_text, key, nonce, aad)</a>

      </div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="decrypt/5">

  <div class="detail-header">
    <a href="#decrypt/5" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">decrypt(cipher_text, key, nonce, aad, tag)</h1>

        <span class="note">(since 0.10.0)</span>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/voice/crypto/chacha.ex#L156" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> decrypt(<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>(), &lt;&lt;_::256&gt;&gt;, &lt;&lt;_::192&gt;&gt;, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>(), &lt;&lt;_::128&gt;&gt;) ::
  <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>() | :error</pre>

      </div>


  </section>
</section>
<section class="detail" id="encrypt/4">

  <div class="detail-header">
    <a href="#encrypt/4" class="detail-link" data-no-tooltip="" aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <div class="heading-with-actions">
      <h1 class="signature" translate="no">encrypt(plain_text, key, nonce, aad)</h1>

        <span class="note">(since 0.10.0)</span>


        <a href="https://github.com/Kraigie/nostrum/blob/master/lib/nostrum/voice/crypto/chacha.ex#L139" class="icon-action" rel="help" aria-label="View Source">
          <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        </a>

    </div>
  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> encrypt(<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>(), &lt;&lt;_::256&gt;&gt;, &lt;&lt;_::192&gt;&gt;, <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">binary</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">iolist</a>()</pre>

      </div>


  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/nostrum/0.11.0-dev" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/nostrum/0.11.0-dev">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="nostrum.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.37.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
